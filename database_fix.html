<!DOCTYPE html>
<html>
<head>
    <title>Database Table Creator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .sql-box {
            background: #f5f5f5;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            margin: 20px 0;
        }
        .copy-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .copy-btn:hover {
            background: #1976D2;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        ol li {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”§ Fix Your Database Table</h1>
        
        <div class="info">
            <p><strong>Problem:</strong> The database has a transaction error preventing table creation.</p>
            <p><strong>Solution:</strong> Run the SQL below to fix it.</p>
        </div>

        <h2>Step 1: Copy this SQL</h2>
        <div class="sql-box" id="sql-code">-- Fix transaction and create table
ROLLBACK;

-- Drop existing table if any
DROP TABLE IF EXISTS menu_embeddings CASCADE;

-- Create the table
CREATE TABLE menu_embeddings (
    id SERIAL PRIMARY KEY,
    restaurant_id VARCHAR(255) NOT NULL,
    item_id VARCHAR(255) NOT NULL,
    item_name VARCHAR(255) NOT NULL,
    item_description TEXT,
    item_price VARCHAR(50),
    item_category VARCHAR(100),
    item_ingredients TEXT,
    dietary_tags TEXT,
    full_text TEXT NOT NULL,
    embedding_json TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Create indexes
CREATE UNIQUE INDEX idx_menu_embeddings_unique ON menu_embeddings(restaurant_id, item_id);
CREATE INDEX idx_menu_embeddings_restaurant ON menu_embeddings(restaurant_id);

-- Verify
SELECT 'SUCCESS! Table created' as status;</div>
        <button class="copy-btn" onclick="copySQL()">ðŸ“‹ Copy SQL</button>
        <span id="copy-status"></span>

        <h2>Step 2: Run it in Railway</h2>
        <ol>
            <li>Go to <a href="https://railway.app/dashboard" target="_blank">Railway Dashboard</a></li>
            <li>Click on your <strong>PostgreSQL</strong> service</li>
            <li>Click the <strong>"Query"</strong> tab</li>
            <li>Paste the SQL and click <strong>"Run Query"</strong></li>
            <li>You should see: <span class="success">SUCCESS! Table created</span></li>
        </ol>

        <h2>Step 3: Verify it worked</h2>
        <p>Run this command to test:</p>
        <div class="sql-box">curl https://restaurantchat-production.up.railway.app/chat \
  -H "Content-Type: application/json" \
  -d '{
    "restaurant_id": "bella_vista_restaurant",
    "client_id": "550e8400-e29b-41d4-a716-446655440000",
    "sender_type": "client",
    "message": "What pasta dishes do you have?"
  }'</div>

        <div class="info" style="background: #c8e6c9; margin-top: 30px;">
            <p><strong>That's it!</strong> Your RAG system will work immediately after running the SQL.</p>
        </div>
    </div>

    <script>
        function copySQL() {
            const sqlCode = document.getElementById('sql-code').textContent;
            navigator.clipboard.writeText(sqlCode).then(() => {
                document.getElementById('copy-status').textContent = ' âœ… Copied!';
                setTimeout(() => {
                    document.getElementById('copy-status').textContent = '';
                }, 2000);
            });
        }
    </script>
</body>
</html>